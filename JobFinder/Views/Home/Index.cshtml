@model SearchViewModel

@{
    ViewData["Title"] = "Search";

    var adzunaHidden = Model.AdzunaCheck ? string.Empty : "hidden";
    var githubHidden = Model.GithubjobsCheck ? string.Empty : "hidden";
    var joobleHidden = Model.JoobleCheck ? string.Empty : "hidden";
    var themuseHidden = Model.ThemuseCheck ? string.Empty : "hidden";
}


<div id="search-container">
    <section id="input-section">
        <form asp-action="Search" method="get">
            <fieldset id="job-boards">
                <legend>Select job boards to include</legend>

                <div>
                    <input asp-for="AdzunaCheck" />
                    <label asp-for="AdzunaCheck"></label>
                </div>
                <div>
                    <input asp-for="GithubjobsCheck" />
                    <label asp-for="GithubjobsCheck"></label>
                </div>
                <div>
                    <input asp-for="JoobleCheck" />
                    <label asp-for="JoobleCheck"></label>
                </div>
                <div>
                    <input asp-for="ThemuseCheck" />
                    <label asp-for="ThemuseCheck"></label>
                </div>
                <div>
                    <input asp-for="UsajobsCheck" />
                    <label asp-for="UsajobsCheck"></label>
                    <sup>USA only</sup>
                </div>
                <div>
                    <input asp-for="ReedCheck" />
                    <label asp-for="ReedCheck"></label>
                    <sup>UK only</sup>
                </div>
            </fieldset>

            <fieldset id="search-params">
                <legend>Enter search parameters</legend>

                <div class="searchParam adzunaReq @adzunaHidden">
                    <span>
                        <span class="red">*</span>
                        <label asp-for="AdzunaCountry"></label>
                    </span>
                    <select asp-for="AdzunaCountry" asp-items="Model.Countries"></select>
                    <span asp-validation-for="AdzunaCountry"></span>
                </div>

                <div class="searchParam themuseReq @themuseHidden">
                    <span>
                        <span class="red">*</span>
                        <label asp-for="ThemuseCategory"></label>
                    </span>
                    <select asp-for="ThemuseCategory" asp-items="Model.ThemuseCategories"></select>
                </div>

                <div class="searchParam">
                    <span>
                        <span class="red joobleReq @joobleHidden">*</span>
                        <label asp-for="Keywords"></label>
                        <sup class="themuseNote @themuseHidden">M</sup>
                    </span>
                    <input asp-for="Keywords" />
                    <span asp-validation-for="Keywords"></span>
                </div>

                <div class="searchParam">
                    <label asp-for="Location"></label>
                    <input asp-for="Location" />
                </div>

                <div class="searchParam">
                    <span>
                        <label asp-for="MilesAway"></label>
                        <sup class="githubNote @githubHidden">G</sup>
                        <sup class="themuseNote @themuseHidden">M</sup>
                    </span>
                    <input asp-for="MilesAway" />
                    <span asp-validation-for="MilesAway"></span>
                </div>

                <div class="searchParam">
                    <span>
                        <label asp-for="MinSalary"></label>
                        <sup class="githubNote @githubHidden">G</sup>
                        <sup class="themuseNote @themuseHidden">M</sup>
                    </span>
                    <input asp-for="MinSalary" />
                    <span asp-validation-for="MinSalary"></span>
                </div>

                <div class="searchParam">
                    <div>
                        <input asp-for="FullTimeOnly" />
                        <span>
                            <label asp-for="FullTimeOnly"></label>
                            <sup class="themuseNote @themuseHidden">M</sup>
                        </span>
                    </div>
                    <div>
                        <input asp-for="PermanentOnly" />
                        <span>
                            <label asp-for="PermanentOnly"></label>
                            <sup class="githubNote @githubHidden">G</sup>
                            <sup class="themuseNote @themuseHidden">M</sup>
                        </span>
                    </div>
                </div>

                <div class="searchParam">
                    <label asp-for="SortBy"></label>
                    <div>
                        <select asp-for="SortBy" asp-items="Model.SortTypes"></select>
                        <select asp-for="SortDirection" asp-items="Model.SortDirections"></select>
                    </div>
                </div>

                <div id="page-num">
                    <div>
                        <span>
                            <span class="red">*</span>
                            <label asp-for="Page"></label>
                        </span>
                        <input asp-for="Page" />
                    </div>
                    <span asp-validation-for="Page"></span>
                </div>

                <div>
                    <div id="requirements">
                        <span>
                            <span class="red">*</span>
                            <span>Required</span>
                        </span>
                        <ul>
                            <li class="adzunaReq @adzunaHidden">Adzuna requires a country</li>
                            <li class="themuseReq @themuseHidden">The Muse requires a category</li>
                            <li class="joobleReq @joobleHidden">Jooble requires at least one keyword</li>
                        </ul>
                    </div>

                    <div id="notes">
                        <div class="githubNote @githubHidden">
                            <sup>G</sup>
                            <span>Not supported by GitHub Jobs</span>
                        </div>
                        <div class="themuseNote @themuseHidden">
                            <sup>M</sup>
                            <span>Not supported by The Muse</span>
                        </div>
                    </div>
                </div>
            </fieldset>

            <div id="search-submit">
                <button type="submit">
                    <i class="fas fa-search"></i>
                    <span>Search</span>
                </button>
            </div>
        </form>
    </section>

    <section id="output-section">
        @if (Model.Results == null)
        {
            <span>Click "Search" to get started!</span>
        }
        else
        {
            if (Model.Results.Count == 0)
            {
                <span id="no-results">No jobs found :(</span>
            }

            if (Model.FailedRequests.Count > 0)
            {
                <div id="failed-requests">
                    There was a problem accessing the following job boards:
                    <ul>
                        @foreach (var jobBoard in Model.FailedRequests)
                        {
                            <li>@jobBoard</li>
                        }
                    </ul>
                    <button id="try-again">Try again?</button>
                </div>
            }

            if (Model.Results.Count > 0)
            {
                <partial name="_JobTablePartial" model="Model.Results" />
            }
        }
    </section>
</div>


@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <partial name="_JobTableScriptsPartial" />

    <!-- Show loading spinner on form submit -->
    <script>
        const outputSection = $('#output-section');
        function showLoadingSpinner() {
            outputSection.html('<div id="loadingSpinner"></div>');
        }

        $('#input-section form').submit(function () {
            if ($(this).valid()) {
                showLoadingSpinner();
            }
        });

        // Try again?: re-submit the previous search
        $('button#try-again').click(function () {
            showLoadingSpinner();
            location.reload();
        });
    </script>

    <!-- Show/hide form requirements on job board check/uncheck -->
    <script>
        const adzunaReqs = $('.adzunaReq');
        const joobleReqs = $('.joobleReq');
        const themuseReqs = $('.themuseReq');
        const githubNotes = $('.githubNote');
        const themuseNotes = $('.themuseNote');

        $('input#AdzunaCheck').change(function () {
            if (this.checked) {
                adzunaReqs.removeClass('hidden');
            }
            else {
                adzunaReqs.addClass('hidden');
            }
        });
        $('input#JoobleCheck').change(function () {
            if (this.checked) {
                joobleReqs.removeClass('hidden');
            }
            else {
                joobleReqs.addClass('hidden');
            }
        });
        $('input#GithubjobsCheck').change(function () {
            if (this.checked) {
                githubNotes.removeClass('hidden');
            }
            else {
                githubNotes.addClass('hidden');
            }
        });
        $('input#ThemuseCheck').change(function () {
            if (this.checked) {
                themuseReqs.removeClass('hidden');
                themuseNotes.removeClass('hidden');
            }
            else {
                themuseReqs.addClass('hidden');
                themuseNotes.addClass('hidden');
            }
        });
    </script>
}